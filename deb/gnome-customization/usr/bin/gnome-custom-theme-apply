#!/bin/bash
sudo true

if [ "$#" == "1" ]
then
	if [ -f "/usr/share/gnome-shell/themes/$1.gresource" ]
	then
		for gresource in /usr/share/gnome-shell/themes/*.gresource
		do
			if [ -f "$gresource" ]
			then
				sudo update-alternatives --remove gdm3-theme.gresource "$gresource"
			fi
		done
		sudo update-alternatives --install "/usr/share/gnome-shell/gdm3-theme.gresource" gdm3-theme.gresource "/usr/share/gnome-shell/themes/$1.gresource" 1000
		echo
		echo
		echo "/!\\ WARNING /!\\"
		echo "If the theme is incompatible with GDM3 and causes it to crash,"
		echo "login to another TTY and run 'gdm3-reset'."
		echo
		echo
		while true
		do
			read -p "Restart GDM3? [Y/n] " yn
			case $yn in
				[Yy]* ) sudo systemctl restart gdm3.service; break;;
				[Nn]* ) break;;
			esac
		done
	else
		echo "This theme doesn't exists!"
	fi
else
	echo "Usage: gnome-custom-theme-apply <theme name>"
	echo
	echo "Syntaxt error!"
fi
